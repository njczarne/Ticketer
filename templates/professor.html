<!DOCTYPE html>
<html>
<head>
    <title>Professor Ticket Screen</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .ticket-description {
            font-style: italic;
            color: #555;
            margin-left: 15px;
        }
    </style>
</head>
<body>
    <h1>Total Tickets: <span id="ticket-count">{{ count }}</span></h1>
    <h2>Current Ticket: <span id="current-ticket">{{ current }}</span></h2>

    <button onclick="completeTicket()">Complete Ticket</button>
    <button onclick="resetSystem()" class="reset">Reset System</button>

    <h3>Dashboard</h3>
    <div id="dashboard">
        {% if not tickets %}
            <p><em>No tickets yet</em></p>
        {% else %}
            {% for ticket in tickets %}
                <div class="ticket {% if ticket.completed %}completed{% endif %}">
                    Ticket {{ ticket.number }} - Group {{ ticket.group }}
                    {% if ticket.description %}
                        <div class="ticket-description">{{ ticket.description }}</div>
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <script>
        const socket = io();

        function completeTicket() {
            socket.emit("complete_ticket");
        }

        function resetSystem() {
            if (confirm("Are you sure you want to reset the system? This will clear all tickets.")) {
                socket.emit("reset_system");
            }
        }

        socket.on("update_count", function(data) {
            document.getElementById("ticket-count").innerText = data.count;
        });

        socket.on("update_current_ticket", function(data) {
            document.getElementById("current-ticket").innerText = data.current;
        });

        socket.on("update_dashboard", function(data) {
            renderDashboard(data.tickets);
        });

        function renderDashboard(tickets) {
            const dashboardDiv = document.getElementById("dashboard");
            dashboardDiv.innerHTML = "";

            if (tickets.length === 0) {
                dashboardDiv.innerHTML = "<p><em>No tickets yet</em></p>";
                return;
            }

            tickets.forEach(ticket => {
                const div = document.createElement("div");
                div.className = "ticket" + (ticket.completed ? " completed" : "");
                div.innerHTML = "Ticket " + ticket.number + " - Group " + ticket.group;

                if (ticket.description) {
                    const descriptionDiv = document.createElement("div");
                    descriptionDiv.className = "ticket-description";
                    descriptionDiv.innerText = ticket.description;
                    div.appendChild(descriptionDiv);
                }
                dashboardDiv.appendChild(div);
            });
        }
    </script>
</body>
</html>